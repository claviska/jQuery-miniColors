/*
 * jQuery miniColors: A small color selector
 *
 * Copyright 2011 Cory LaViska for A Beautiful Site, LLC. (http://abeautifulsite.net/)
 *
 * Dual licensed under the MIT or GPL Version 2 licenses
 *
*/jQuery&&function(a){a.extend(a.fn,{miniColors:function(b,c){var d=function(b,c,d){var e=s(b.val());e||(e="ffffff");var f=x(e),h=a('<a class="miniColors-trigger" style="background-color: #'+e+'" href="#"></a>');h.insertAfter(b),b.addClass("miniColors").data("original-maxlength",b.attr("maxlength")||null).data("original-autocomplete",b.attr("autocomplete")||null).data("letterCase","uppercase").data("trigger",h).data("hsb",f).data("change",c.change?c.change:null).attr("maxlength",7).attr("autocomplete","off").val("#"+o(e,c.letterCase)),c.readonly&&b.prop("readonly",!0),c.disabled&&g(b),h.bind("click.miniColors",function(a){a.preventDefault(),b.val()===""&&b.val("#"),i(b)}),b.bind("focus.miniColors",function(a){b.val()===""&&b.val("#"),i(b)}),b.bind("blur.miniColors",function(a){var c=s(b.val());b.val(c?"#"+o(c,b.data("letterCase")):"")}),b.bind("keydown.miniColors",function(a){a.keyCode===9&&j(b)}),b.bind("keyup.miniColors",function(a){n(b)}),b.bind("paste.miniColors",function(a){setTimeout(function(){n(b)},5)})},e=function(b){j(),b=a(b),b.data("trigger").remove(),b.attr("autocomplete",b.data("original-autocomplete")).attr("maxlength",b.data("original-maxlength")).removeData().removeClass("miniColors").unbind(".miniColors"),a(document).unbind(".miniColors")},f=function(a){a.prop("disabled",!1).data("trigger").css("opacity",1)},g=function(a){j(a),a.prop("disabled",!0).data("trigger").css("opacity",.5)},i=function(b){if(b.prop("disabled"))return!1;j();var c=a('<div class="miniColors-selector"></div>');c.append('<div class="miniColors-colors" style="background-color: #FFF;"><div class="miniColors-colorPicker"></div></div>').append('<div class="miniColors-hues"><div class="miniColors-huePicker"></div></div>').css({top:b.is(":visible")?b.offset().top+b.outerHeight():b.data("trigger").offset().top+b.data("trigger").outerHeight(),left:b.is(":visible")?b.offset().left:b.data("trigger").offset().left,display:"none"}).addClass(b.attr("class")),b[0].type=="hidden"&&(c.append('<form class="miniColors-inputs"><input class="miniColors-textInput" input="text"><input type="submit" class="miniColors-buttonInput" value="Done"/></form>').addClass("miniColors-with-hiddeninput"),c.find(".miniColors-inputs").bind("submit",function(a){a.preventDefault(),b.val(c.find(".miniColors-textInput").val()),n(b),setTimeout(j,100)}));var d=b.data("hsb");c.find(".miniColors-colors").css("backgroundColor","#"+y({h:d.h,s:100,b:100}));var e=b.data("colorPosition");e||(e=p(d)),c.find(".miniColors-colorPicker").css("top",e.y+"px").css("left",e.x+"px");var f=b.data("huePosition");f||(f=q(d)),c.find(".miniColors-huePicker").css("top",f.y+"px"),b.data("selector",c).data("huePicker",c.find(".miniColors-huePicker")).data("colorPicker",c.find(".miniColors-colorPicker")).data("textInput",c.find(".miniColors-textInput").val(b.val())).data("mousebutton",0),a("BODY").append(c),c.fadeIn(100),c.bind("selectstart",function(){return!1}),a(document).bind("mousedown.miniColors touchstart.miniColors",function(c){if(a(c.target).parents().andSelf().hasClass("miniColors-inputs"))return;b.data("mousebutton",1),a(c.target).parents().andSelf().hasClass("miniColors-colors")&&(c.preventDefault(),b.data("moving","colors"),k(b,c)),a(c.target).parents().andSelf().hasClass("miniColors-hues")&&(c.preventDefault(),b.data("moving","hues"),l(b,c));if(a(c.target).parents().andSelf().hasClass("miniColors-selector")){c.preventDefault();return}if(a(c.target).parents().andSelf().hasClass("miniColors"))return;j(b)}),a(document).bind("mouseup.miniColors touchend.miniColors",function(a){a.preventDefault(),b.data("mousebutton",0).removeData("moving")}).bind("mousemove.miniColors touchmove.miniColors",function(a){a.preventDefault(),b.data("mousebutton")===1&&(b.data("moving")==="colors"&&k(b,a),b.data("moving")==="hues"&&l(b,a))})},j=function(b){b||(b=".miniColors"),a(b).each(function(){var b=a(this).data("selector");a(this).removeData("selector"),a(b).fadeOut(100,function(){a(this).remove()})}),a(document).unbind(".miniColors")},k=function(a,b){var c=a.data("colorPicker");c.hide();var d={x:b.pageX,y:b.pageY};b.originalEvent.changedTouches&&(d.x=b.originalEvent.changedTouches[0].pageX,d.y=b.originalEvent.changedTouches[0].pageY),d.x=d.x-a.data("selector").find(".miniColors-colors").offset().left-5,d.y=d.y-a.data("selector").find(".miniColors-colors").offset().top-5,d.x<=-5&&(d.x=-5),d.x>=144&&(d.x=144),d.y<=-5&&(d.y=-5),d.y>=144&&(d.y=144),a.data("colorPosition",d),c.css("left",d.x).css("top",d.y).show();var e=Math.round((d.x+5)*.67);e<0&&(e=0),e>100&&(e=100);var f=100-Math.round((d.y+5)*.67);f<0&&(f=0),f>100&&(f=100);var g=a.data("hsb");g.s=e,g.b=f,m(a,g,!0)},l=function(a,b){var c=a.data("huePicker");c.hide();var d={y:b.pageY};b.originalEvent.changedTouches&&(d.y=b.originalEvent.changedTouches[0].pageY),d.y=d.y-a.data("selector").find(".miniColors-colors").offset().top-1,d.y<=-1&&(d.y=-1),d.y>=149&&(d.y=149),a.data("huePosition",d),c.css("top",d.y).show();var e=Math.round((150-d.y-1)*2.4);e<0&&(e=0),e>360&&(e=360);var f=a.data("hsb");f.h=e,m(a,f,!0)},m=function(a,b,c){a.data("hsb",b);var d=y(b);c&&a.val("#"+o(d,a.data("letterCase"))),c&&a.data("textInput").val(a.val()),a.data("trigger").css("backgroundColor","#"+d),a.data("selector")&&a.data("selector").find(".miniColors-colors").css("backgroundColor","#"+y({h:b.h,s:100,b:100}));if(a.data("change")){if(d===a.data("lastChange"))return;a.data("change").call(a,"#"+d,t(b)),a.data("lastChange",d)}},n=function(b){b.val("#"+r(b.val()));var c=s(b.val());if(!c)return!1;var d=x(c),e=b.data("hsb");if(d.h===e.h&&d.s===e.s&&d.b===e.b)return!0;var f=p(d),g=a(b.data("colorPicker"));g.css("top",f.y+"px").css("left",f.x+"px"),b.data("colorPosition",f);var h=q(d),i=a(b.data("huePicker"));return i.css("top",h.y+"px"),b.data("huePosition",h),m(b,d),!0},o=function(a,b){return b==="lowercase"?a.toLowerCase():b==="uppercase"?a.toUpperCase():a},p=function(a){var b=Math.ceil(a.s/.67);b<0&&(b=0),b>150&&(b=150);var c=150-Math.ceil(a.b/.67);return c<0&&(c=0),c>150&&(c=150),{x:b-5,y:c-5}},q=function(a){var b=150-a.h/2.4;return b<0&&(h=0),b>150&&(h=150),{y:b-1}},r=function(a){return a.replace(/[^A-F0-9]/ig,"")},s=function(a){return a=r(a),a?(a.length===3&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]),a.length===6?a:null):null},t=function(a){var b={},c=Math.round(a.h),d=Math.round(a.s*255/100),e=Math.round(a.b*255/100);if(d===0)b.r=b.g=b.b=e;else{var f=e,g=(255-d)*e/255,h=(f-g)*(c%60)/60;c===360&&(c=0),c<60?(b.r=f,b.b=g,b.g=g+h):c<120?(b.g=f,b.b=g,b.r=f-h):c<180?(b.g=f,b.r=g,b.b=g+h):c<240?(b.b=f,b.r=g,b.g=f-h):c<300?(b.b=f,b.g=g,b.r=g+h):c<360?(b.r=f,b.g=g,b.b=f-h):(b.r=0,b.g=0,b.b=0)}return{r:Math.round(b.r),g:Math.round(b.g),b:Math.round(b.b)}},u=function(b){var c=[b.r.toString(16),b.g.toString(16),b.b.toString(16)];return a.each(c,function(a,b){b.length===1&&(c[a]="0"+b)}),c.join("")},v=function(a){return a=parseInt(a.indexOf("#")>-1?a.substring(1):a,16),{r:a>>16,g:(a&65280)>>8,b:a&255}},w=function(a){var b={h:0,s:0,b:0},c=Math.min(a.r,a.g,a.b),d=Math.max(a.r,a.g,a.b),e=d-c;return b.b=d,b.s=d!==0?255*e/d:0,b.s!==0?a.r===d?b.h=(a.g-a.b)/e:a.g===d?b.h=2+(a.b-a.r)/e:b.h=4+(a.r-a.g)/e:b.h=-1,b.h*=60,b.h<0&&(b.h+=360),b.s*=100/255,b.b*=100/255,b},x=function(a){var b=w(v(a));return b.s===0&&(b.h=360),b},y=function(a){return u(t(a))};switch(b){case"readonly":return a(this).each(function(){if(!a(this).hasClass("miniColors"))return;a(this).prop("readonly",c)}),a(this);case"disabled":return a(this).each(function(){if(!a(this).hasClass("miniColors"))return;c?g(a(this)):f(a(this))}),a(this);case"value":if(c===undefined){if(!a(this).hasClass("miniColors"))return;var z=a(this),A=s(z.val());return A?"#"+o(A,z.data("letterCase")):null}return a(this).each(function(){if(!a(this).hasClass("miniColors"))return;a(this).val(c),n(a(this))}),a(this);case"destroy":return a(this).each(function(){if(!a(this).hasClass("miniColors"))return;e(a(this))}),a(this);default:return b||(b={}),a(this).each(function(){if(a(this)[0].tagName.toLowerCase()!=="input")return;if(a(this).data("trigger"))return;d(a(this),b,c)}),a(this)}}})}(jQuery);